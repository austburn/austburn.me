---
# Install docker

- name: apt-get update
  apt: update_cache=yes

- name: install packages
  apt: name={{ item }} state=present
  with_items:
    - apt-transport-https
    - ca-certificates
    - make
    - python-pip
    - bc
    - git
    - apparmor
    - linux-image-generic-lts-trusty
    - linux-image-extra-{{ ansible_kernel }}

- name: add docker key
  command: apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D

- name: add docker entry
  copy: src=files/docker.list dest=/etc/apt/sources.list.d/docker.list

- name: apt-get update to get docker
  apt: update_cache=yes

- name: ensure old docker not present
  apt: name=lxc-docker state=absent

- name: install docker
  apt: name=docker-engine state=present

- name: start docker service
  service: name=docker state=started

- name: add user to docker group
  user: name=austin groups=docker append=yes

- name: install docker-py
  become: true
  become_user: root
  pip: name=docker-py state=present
